function showMessage(e,o){var a=$("#messages"),t=a.find(".alert"),l=e?"alert-danger":"alert-success",n=e?"fa-ban":"fa-check",r=gettext(e?"Error!":"Success!"),s=$("<div>",{"class":"alert alert-dismissable "+l});s.append($('<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>')).append($("<h4>").append($("<i>",{"class":"fa "+n})," "+r)).append(o).fadeIn(),0!==t.length?t.first().before(s):s.appendTo("#messages")}function google_reverse_geocode(e){map.setCenter(e),geocoder.geocode({latLng:e},function(e,o){if(o==google.maps.GeocoderStatus.OK&&e[0]){var a=$("#select2-google_geocode-container"),t=e[0].formatted_address;a.attr("title",t),a.html('<span class="select2-selection__clear">×</span>'+t),$title.val(t),showMessage(!1,gettext("Was found geo object")+': "{0}"'.f(t.bold().italics()))}})}function initialize(){var e={zoom:12,mapTypeId:google.maps.MapTypeId.HYBRID};map=new google.maps.Map(document.getElementById("map_canvas"),e),geocoder=new google.maps.Geocoder,marker=new google.maps.Marker({map:map,draggable:!0});var o=new google.maps.LatLng(55.920963,37.80495829999995);marker.setPosition(o),google_reverse_geocode(o),$lat.val(o.lat()),$lon.val(o.lng()),google.maps.event.addListener(marker,"drag",function(){var e=marker.getPosition();geocoder.geocode({latLng:e},function(o,a){if(a==google.maps.GeocoderStatus.OK&&o[0]){var t=$("#select2-google_geocode-container");t.attr("title",o[0].formatted_address),t.html('<span class="select2-selection__clear">×</span>'+o[0].formatted_address),$lat.val(e.lat()),$lon.val(e.lng()),$title.val(o[0].formatted_address)}}),map.setCenter(e)})}var geocoder,map,marker,$title=$("#id_title"),$lat=$("#id_lat"),$lon=$("#id_lon"),$coords=$('<div class="row" id="coords"></div>'),$lon_container=$("#div_id_lon"),$lat_container=$("#div_id_lat");$("#create-geo_object").before($('<div class="row" id="geocoders"></div>')),$coords.append($lat_container.addClass("col-sm-6"),$lon_container.addClass("col-sm-6")),$("#div_id_title").after($coords),$coords.after($('<div id="map_canvas" style="width:100%; height:600px; margin-bottom: 15px"></div>')),initialize(),$lat.keyup(function(){var e=new google.maps.LatLng($(this).val(),$lon.val());marker.setPosition(e),google_reverse_geocode(e)}),$lon.keyup(function(){var e=new google.maps.LatLng($lat.val(),$(this).val());marker.setPosition(e),google_reverse_geocode()}),String.prototype.format=String.prototype.f=function(){var e=arguments;return this.replace(/\{\{|\}\}|\{(\d+)\}/g,function(o,a){return"{{"==o?"{":"}}"==o?"}":e[a]})};var $nominatim_geocode=$('<select class="form-control" id="nominatim_geocode"></select>');$(document).ready(function(){$nominatim_geocode.select2({placeholder:"Search geo object with Nominatim Geocoder...",allowClear:!0,minimumInputLength:3,language:"ru",ajax:{url:"http://nominatim.openstreetmap.org/search",dataType:"json",delay:300,type:"GET",cache:!0,data:function(e){return{q:e.term,format:"json",polygon_kml:1}},processResults:function(e,o){o.page=o.page||1;var a=e.map(function(e){return{id:"("+e.lat+", "+e.lon+")",text:e.display_name,lat:e.lat,lon:e.lon,polygon:e.geokml}});return{results:a}}},templateResult:function(e){return e.loading?e.text:$('<strong>{0}</strong><span class="pull-right">({1},{2})</span>'.f(e.text,e.lat,e.lon))}})}),$("#geocoders").append($('<div class="form-group col-md-6""><label for="nominatim_geocode" class="control-label">Nominatim geocoder</label></div>').append($nominatim_geocode)),$nominatim_geocode.on("select2:select",function(e){var o=e.params.data;$("#id_lat").val(o.lat),$("#id_lon").val(o.lon),$("#id_title").val(o.text),$("#id_polygon").val(o.polygon);var a=new google.maps.LatLng(o.lat,o.lon);marker.setPosition(a),map.setCenter(a)});var $google_geocode=$('<select class="form-control" id="google_geocode"></select>');$(document).ready(function(){$google_geocode.select2({placeholder:"Search geo object with Google Geocoder...",allowClear:!0,ajax:{url:"https://maps.googleapis.com/maps/api/geocode/json",dataType:"json",type:"GET",cache:!0,data:function(e){return{address:e.term,key:"AIzaSyDVEXypca7bWLD1my4Wvc6AQTjsIM88MZw"}},processResults:function(e,o){o.page=o.page||1;var a=e.results.map(function(e){return{id:"("+e.geometry.location.lat+", "+e.geometry.location.lng+")",text:e.formatted_address,lat:e.geometry.location.lat,lon:e.geometry.location.lng,polygon:""}});return{results:a}}},templateResult:function(e){return e.loading?e.text:$('<strong>{0}</strong><span class="pull-right">({1},{2})</span>'.f(e.text,e.lat,e.lon))}})}),$("#geocoders").append($('<div class="form-group col-md-6"><label for="google_geocode" class="control-label">Google geocoder</label></div>').append($google_geocode)),$google_geocode.on("select2:select",function(e){var o=e.params.data;$("#id_lat").val(o.lat),$("#id_lon").val(o.lon),$("#id_title").val(o.text),$("#id_polygon").val(o.polygon);var a=new google.maps.LatLng(o.lat,o.lon);marker.setPosition(a),map.setCenter(a)});