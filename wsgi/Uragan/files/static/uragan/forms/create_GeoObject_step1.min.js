function google_reverse_geocode(e){map.setCenter(e),geocoder.geocode({latLng:e},function(o,t){if(t==google.maps.GeocoderStatus.OK&&o[0]){var a=$("#select2-google_geocode-container"),l=o[0].formatted_address;a.attr("title",l),a.html('<span class="select2-selection__clear">Ã—</span>'+l),$title.val(l),$lat.val(e.lat()),$lon.val(e.lng()),showMessage(!1,gettext("Was found geo object")+': "{0}"'.f(l.bold().italics()))}})}function initialize(){var e=new google.maps.LatLng(55.920963,37.80495829999995),o={center:e,zoom:12,mapTypeId:google.maps.MapTypeId.HYBRID};map=new google.maps.Map(document.getElementById("map_canvas"),o),geocoder=new google.maps.Geocoder,marker=new google.maps.Marker({map:map,draggable:!0}),google.maps.event.addListener(marker,"drag",function(){var e=marker.getPosition();google_reverse_geocode(e)})}var geocoder,map,marker,$form=$("#create-geo_object"),$title=$form.find("[id^=id_][id$=title]"),$lat=$form.find("[id^=id_][id$=lat]"),$lon=$form.find("[id^=id_][id$=lon]"),$coords=$('<div class="row" id="coords"></div>'),$lon_container=$form.find("[id^=div_id_][id$=lon]"),$lat_container=$form.find("[id^=div_id_][id$=lat]");$form.find("[id^=div_id_][id$=title]").before($('<div class="row" id="geocoders"></div>')),$coords.append($lat_container.addClass("col-sm-6"),$lon_container.addClass("col-sm-6")),$form.find("[id^=div_id_][id$=title]").after($coords),$('<div id="map_canvas" style="width:100%; height: {0}" ></div>'.f($(".content").css("height"))).appendTo($form),$lat.keyup(function(){var e=new google.maps.LatLng($(this).val(),$lon.val());marker.setPosition(e),google_reverse_geocode(e)}),$lon.keyup(function(){var e=new google.maps.LatLng($lat.val(),$(this).val());marker.setPosition(e),google_reverse_geocode()}),$(document).ready(initialize());var $google_geocode=$('<select class="form-control" id="google_geocode" style="width: 100%"></select>');$(document).ready(function(){$google_geocode.select2({placeholder:gettext("Search geo object with Google Geocoder..."),allowClear:!0,ajax:{url:"https://maps.googleapis.com/maps/api/geocode/json",dataType:"json",type:"GET",cache:!0,data:function(e){return{address:e.term,key:"AIzaSyDVEXypca7bWLD1my4Wvc6AQTjsIM88MZw"}},processResults:function(e,o){o.page=o.page||1;var t=e.results.map(function(e){return{id:"("+e.geometry.location.lat+", "+e.geometry.location.lng+")",text:e.formatted_address,lat:e.geometry.location.lat,lon:e.geometry.location.lng,polygon:""}});return{results:t}}},templateResult:function(e){return e.loading?e.text:$('<strong>{0}</strong><span class="pull-right">({1},{2})</span>'.f(e.text,e.lat,e.lon))}})}),$("#geocoders").append($("<div>",{"class":"col-md-6 form-group"}).append($("<label>",{"for":"google_geocode","class":"control-label"}).append("Google geocoder"),$google_geocode)),$google_geocode.on("select2:select",function(e){var o=e.params.data;$("[id^=id_][id$=lat]").val(o.lat),$("[id^=id_][id$=lon]").val(o.lon),$("[id^=id_][id$=title]").val(o.text),$("[id^=id_][id$=polygon]").val(o.polygon);var t=new google.maps.LatLng(o.lat,o.lon);marker.setPosition(t),map.setCenter(t)});var $nominatim_geocode=$('<select class="form-control" id="nominatim_geocode" style="width: 100%"></select>');$(document).ready(function(){$nominatim_geocode.select2({placeholder:gettext("Search geo object with Nominatim Geocoder..."),allowClear:!0,minimumInputLength:3,language:"ru",ajax:{url:"http://nominatim.openstreetmap.org/search",dataType:"json",delay:1e3,type:"GET",cache:!0,data:function(e){return{q:e.term,format:"json",polygon_kml:1}},processResults:function(e,o){o.page=o.page||1;var t=e.map(function(e){return{id:"("+e.lat+", "+e.lon+")",text:e.display_name,lat:e.lat,lon:e.lon,polygon:e.geokml?e.geokml:""}});return{results:t}}},templateResult:function(e){return e.loading?e.text:$('<strong>{0}</strong><span class="pull-right">({1},{2})</span>'.f(e.text,e.lat,e.lon))}})}),$("#geocoders").append($("<div>",{"class":"col-md-6 form-group"}).append($("<label>",{"for":"nominatim_geocode","class":"control-label"}).append("Nominatim geocoder"),$nominatim_geocode));var polygon;$nominatim_geocode.on("select2:select",function(e){var o=e.params.data;$("[id^=id_][id$=lat]").val(o.lat),$("[id^=id_][id$=lon]").val(o.lon),$("[id^=id_][id$=title]").val(o.text),$("[id^=id_][id$=polygon]").val(o.polygon);var t=new google.maps.LatLng(o.lat,o.lon);marker.setPosition(t),map.setCenter(t)});